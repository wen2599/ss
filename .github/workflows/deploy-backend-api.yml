# .github/workflows/deploy-api.yml

# Before running this workflow, make sure you’ve configured these repository secrets:
#   SERV00_SSH_KEY   – SSH private key for deploy user (wenge9529)
#   SERV00_USER      – wenge9529
#   SERV00_HOST      – 9525.ip-ddns.com
#   SERV00_PATH      – /home/wenge9529/domains/9525.ip-ddns.com/public_html

name: Deploy backend/api to serv00

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:

      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up SSH agent
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.SERV00_SSH_KEY }}

      - name: Deploy backend/api via rsync
        run: |
          rsync -avz --delete \
            --exclude='config.php' \
            -e "ssh -o StrictHostKeyChecking=no" \
            ./backend/api/ \
            ${{ secrets.SERV00_USER }}@${{ secrets.SERV00_HOST }}:${{ secrets.SERV00_PATH }}/api/
