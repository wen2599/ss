<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /

  # Rule 1: Route all API calls to the backend.
  # If the query string contains 'action=', rewrite the request to the backend's
  # index.php file and stop processing other rules. The [L] flag is crucial.
  RewriteCond %{QUERY_STRING} action= [NC]
  RewriteRule ^(.*)$ backend/index.php [L,QSA]

  # Rule 2: Handle client-side routing for the React application.
  # If the request is not for an existing file or directory,
  # serve the main frontend index.html file and let React Router take over.
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule . /frontend/index.html [L]
</IfModule>