{"ast":null,"code":"import React,{useState}from'react';import Card from'./Card';import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";function PlayerArea(_ref){let{player,isCurrentPlayer}=_ref;const[selectedCards,setSelectedCards]=useState([]);const[currentPlay,setCurrentPlay]=useState({valid:false,type:null,value:null,length:0});const getCardComparableValue=filename=>{const nameParts=filename.split('_');const value=nameParts[0];const suit=nameParts[2]?nameParts[2].split('.')[0]:'';const valueMap={'3':3,'4':4,'5':5,'6':6,'7':7,'8':8,'9':9,'10':10,'jack':11,'queen':12,'king':13,'ace':14,'2':15};let numericalValue=valueMap[value]||0;if(filename==='black_joker.svg')numericalValue=16;if(filename==='red_joker.svg')numericalValue=17;const suitMap={'diamonds':1,'clubs':2,'hearts':3,'spades':4};let suitValue=suitMap[suit]||0;return{value:numericalValue,suit:suitValue,filename:filename};};const compareCards=(cardA,cardB)=>{if(cardA.value!==cardB.value)return cardA.value-cardB.value;return cardA.suit-cardB.suit;};const isValidPlay=cards=>{const numCards=cards.length;if(numCards===0)return{valid:false,type:null};const comparableCards=cards.map(getCardComparableValue).sort(compareCards);const cardValues=comparableCards.map(card=>card.value);if(numCards===2&&cardValues.includes(16)&&cardValues.includes(17)){return{valid:true,type:'rocket',value:18,length:2};}if(numCards===1)return{valid:true,type:'single',value:cardValues[0],length:1};if(numCards===2&&cardValues[0]===cardValues[1]){return{valid:true,type:'pair',value:cardValues[0],length:2};}if(numCards===3&&cardValues[0]===cardValues[1]&&cardValues[1]===cardValues[2]){return{valid:true,type:'triple',value:cardValues[0],length:3};}if(numCards>=5&&areConsecutive(cardValues)&&!cardValues.includes(15)&&!cardValues.includes(16)&&!cardValues.includes(17)){return{valid:true,type:'straight',value:cardValues[0],length:numCards};}if(numCards===4&&cardValues[0]===cardValues[1]&&cardValues[1]===cardValues[2]&&cardValues[2]===cardValues[3]){return{valid:true,type:'bomb',value:cardValues[0],length:4};}return{valid:false,type:null};};const areConsecutive=values=>{for(let i=0;i<values.length-1;i++){if(values[i+1]!==values[i]+1)return false;}return true;};const handleCardClick=cardFilename=>{if(!isCurrentPlayer)return;if(selectedCards.includes(cardFilename)){setSelectedCards(selectedCards.filter(card=>card!==cardFilename));}else{setSelectedCards([...selectedCards,cardFilename]);}const updatedSelectedCards=selectedCards.includes(cardFilename)?selectedCards.filter(card=>card!==cardFilename):[...selectedCards,cardFilename];setCurrentPlay(isValidPlay(updatedSelectedCards));};const handleCancelSelection=()=>{setSelectedCards([]);setCurrentPlay({valid:false,type:null,value:null,length:0});};const handlePlayCards=()=>{if(currentPlay.valid){console.log(\"Valid play:\",selectedCards);// TODO: Send play to backend\n}console.log(\"Attempting to play:\",selectedCards);};return/*#__PURE__*/_jsxs(\"div\",{className:`player-area ${player.isLandlord?'landlord':''} ${player.isCurrentPlayer?'current-player-area':''}`,children:[/*#__PURE__*/_jsxs(\"h3\",{children:[player.name,\" \",player.isLandlord&&'(地主)']}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Score: \",player.score]}),/*#__PURE__*/_jsx(\"div\",{className:\"player-hand\",children:player.hand&&player.hand.map((cardFilename,index)=>/*#__PURE__*/_jsx(Card,{filename:cardFilename,onClick:()=>handleCardClick(cardFilename),isSelected:selectedCards.includes(cardFilename)},index))}),isCurrentPlayer&&/*#__PURE__*/_jsxs(\"div\",{className:\"action-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{disabled:true,children:\"\\u53EB\\u5730\\u4E3B\"}),/*#__PURE__*/_jsx(\"button\",{disabled:true,children:\"\\u4E0D\\u53EB\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handlePlayCards,disabled:!currentPlay.valid,children:\"\\u51FA\\u724C\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>console.log(\"Pass\"),children:\"\\u4E0D\\u8981\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleCancelSelection,children:\"\\u53D6\\u6D88\\u9009\\u62E9\"})]})]});}export default PlayerArea;","map":{"version":3,"names":["React","useState","Card","jsxs","_jsxs","jsx","_jsx","PlayerArea","_ref","player","isCurrentPlayer","selectedCards","setSelectedCards","currentPlay","setCurrentPlay","valid","type","value","length","getCardComparableValue","filename","nameParts","split","suit","valueMap","numericalValue","suitMap","suitValue","compareCards","cardA","cardB","isValidPlay","cards","numCards","comparableCards","map","sort","cardValues","card","includes","areConsecutive","values","i","handleCardClick","cardFilename","filter","updatedSelectedCards","handleCancelSelection","handlePlayCards","console","log","className","isLandlord","children","name","score","hand","index","onClick","isSelected","disabled"],"sources":["/home/user/ss/frontend/src/components/PlayerArea.js"],"sourcesContent":["import React, { useState } from 'react'; \nimport Card from './Card'; \n\nfunction PlayerArea({ player, isCurrentPlayer }) {\n  const [selectedCards, setSelectedCards] = useState([]);\n  const [currentPlay, setCurrentPlay] = useState({ valid: false, type: null, value: null, length: 0 });\n\n  const getCardComparableValue = (filename) => {\n    const nameParts = filename.split('_');\n    const value = nameParts[0];\n    const suit = nameParts[2] ? nameParts[2].split('.')[0] : '';\n\n    const valueMap = {\n      '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10,\n      'jack': 11, 'queen': 12, 'king': 13, 'ace': 14, '2': 15\n    };\n\n    let numericalValue = valueMap[value] || 0;\n    if (filename === 'black_joker.svg') numericalValue = 16;\n    if (filename === 'red_joker.svg') numericalValue = 17;\n\n    const suitMap = {\n      'diamonds': 1, 'clubs': 2, 'hearts': 3, 'spades': 4\n    };\n    let suitValue = suitMap[suit] || 0;\n\n    return { value: numericalValue, suit: suitValue, filename: filename };\n  };\n\n  const compareCards = (cardA, cardB) => {\n      if (cardA.value !== cardB.value) return cardA.value - cardB.value;\n      return cardA.suit - cardB.suit;\n  };\n\n  const isValidPlay = (cards) => {\n    const numCards = cards.length;\n    if (numCards === 0) return { valid: false, type: null };\n\n    const comparableCards = cards.map(getCardComparableValue).sort(compareCards);\n    const cardValues = comparableCards.map(card => card.value);\n\n    if (numCards === 2 && cardValues.includes(16) && cardValues.includes(17)) {\n         return { valid: true, type: 'rocket', value: 18, length: 2 };\n    }\n\n    if (numCards === 1) return { valid: true, type: 'single', value: cardValues[0], length: 1 };\n    \n    if (numCards === 2 && cardValues[0] === cardValues[1]) {\n      return { valid: true, type: 'pair', value: cardValues[0], length: 2 };\n    }\n\n    if (numCards === 3 && cardValues[0] === cardValues[1] && cardValues[1] === cardValues[2]) {\n        return { valid: true, type: 'triple', value: cardValues[0], length: 3 };\n    }\n\n    if (numCards >= 5 && areConsecutive(cardValues) && !cardValues.includes(15) && !cardValues.includes(16) && !cardValues.includes(17)) {\n        return { valid: true, type: 'straight', value: cardValues[0], length: numCards };\n    }\n\n    if (numCards === 4 && cardValues[0] === cardValues[1] && cardValues[1] === cardValues[2] && cardValues[2] === cardValues[3]) {\n        return { valid: true, type: 'bomb', value: cardValues[0], length: 4 };\n    }\n\n    return { valid: false, type: null };\n  };\n\n  const areConsecutive = (values) => {\n      for (let i = 0; i < values.length - 1; i++) {\n          if (values[i + 1] !== values[i] + 1) return false;\n      }\n      return true;\n  };\n\n  const handleCardClick = (cardFilename) => {\n    if (!isCurrentPlayer) return;\n\n    if (selectedCards.includes(cardFilename)) {\n      setSelectedCards(selectedCards.filter(card => card !== cardFilename));\n    } else {\n      setSelectedCards([...selectedCards, cardFilename]);\n    }\n\n    const updatedSelectedCards = selectedCards.includes(cardFilename)\n        ? selectedCards.filter(card => card !== cardFilename)\n        : [...selectedCards, cardFilename];\n    setCurrentPlay(isValidPlay(updatedSelectedCards));\n  };\n  \n  const handleCancelSelection = () => {\n    setSelectedCards([]);\n    setCurrentPlay({ valid: false, type: null, value: null, length: 0 });\n  };\n\n  const handlePlayCards = () => {\n    if (currentPlay.valid) {\n      console.log(\"Valid play:\", selectedCards);\n      // TODO: Send play to backend\n    }\n    console.log(\"Attempting to play:\", selectedCards);\n  };\n\n  return (\n    <div className={`player-area ${player.isLandlord ? 'landlord' : ''} ${player.isCurrentPlayer ? 'current-player-area' : ''}`}>\n      <h3>{player.name} {player.isLandlord && '(地主)'}</h3>\n      <p>Score: {player.score}</p>\n\n      <div className=\"player-hand\">\n        {player.hand && player.hand.map((cardFilename, index) => (\n          <Card\n            key={index}\n            filename={cardFilename}\n            onClick={() => handleCardClick(cardFilename)}\n            isSelected={selectedCards.includes(cardFilename)}\n          />\n        ))}\n      </div>\n\n      {isCurrentPlayer && (\n        <div className=\"action-buttons\">\n          <button disabled={true}>叫地主</button>\n          <button disabled={true}>不叫</button>\n          <button onClick={handlePlayCards} disabled={!currentPlay.valid}>出牌</button>\n          <button onClick={() => console.log(\"Pass\")}>不要</button>\n          <button onClick={handleCancelSelection}>取消选择</button>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default PlayerArea;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}